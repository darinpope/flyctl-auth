apiVersion: automation.cloudbees.io/v1alpha1
kind: action
name: 'flyctl auth'
description: 'flyctl auth'

inputs:
  command:
    description: 'command'
    default: docker
  fly-api-token-property:
    description: 'Fly API token property'
    required: true
  
runs:
  using: composite
  steps:
    - id: flyctl-auth
      name: Login to Fly.io registry
      uses: docker://darinpope/flyctl:0.1.129
      shell: sh
      env:
        FLY_API_TOKEN: ${{ secrets.${{ inputs.fly-api-token-property }} }}
        NO_COLOR: "1"
      run: |
        flyctl auth ${{ inputs.command }}